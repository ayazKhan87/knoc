<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Win Free Bottle - Flappy Bird</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="manifest" href="manifest.json">
    <link rel="icon" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHZpZXdCb3g9IjAgMCAzMiAzMiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjMyIiBoZWlnaHQ9IjMyIiBmaWxsPSIjMGEwYTBhIi8+CjxjaXJjbGUgY3g9IjE2IiBjeT0iMTYiIHI9IjgiIGZpbGw9IiNmZmUwNjYiLz4KPGNpcmNsZSBjeD0iMTgiIGN5PSIxNCIgcj0iMiIgZmlsbD0iIzFhMWExYSIvPgo8cGF0aCBkPSJNMjAgMTJMMjIgMTFMMjAgMTQiIGZpbGw9IiNmZjdjMzIiLz4KPC9zdmc+Cg==" type="image/svg+xml">
    <meta name="theme-color" content="#0a0a0a">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <style>
        /* Minimal styles to ensure canvas sizing */
        html, body { height: 100%; margin: 0; background: #0a0a0a; }
        #gameContainer { position: fixed; inset: 0; display: flex; align-items: center; justify-content: center; }
        #flappyCanvas { width: min(600px, 100vw); height: min(800px, 100vh); background: linear-gradient(#70c5ce, #ffffff); box-shadow: 0 0 40px rgba(0,0,0,0.4) inset; border-radius: 8px; }
        .hud { position: fixed; top: 16px; left: 50%; transform: translateX(-50%); color: #fff; font-family: Arial, Helvetica, sans-serif; text-shadow: 0 2px 0 rgba(0,0,0,0.3); display: flex; gap: 24px; align-items: center; }
        .btn { background: rgba(0,0,0,0.4); color: #fff; border: 1px solid rgba(255,255,255,0.3); padding: 8px 12px; border-radius: 6px; cursor: pointer; }
        /* Overlays */
        .overlay { position: fixed; inset: 0; display: none; align-items: center; justify-content: center; background: rgba(0,0,0,0.6); z-index: 50; font-family: Arial, Helvetica, sans-serif; }
        .overlay.show { display: flex; }
        .panel { width: min(640px, 92vw); background: #111; color: #fff; border: 1px solid rgba(255,255,255,0.2); border-radius: 12px; padding: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        .panel h2 { margin: 0 0 10px; }
        .panel ol { margin: 10px 0 0 18px; }
        .panel p { margin: 10px 0; }
        .panel .actions { display: flex; gap: 12px; flex-wrap: wrap; margin-top: 16px; }
        .muted { color: #ccc; font-size: 14px; }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .error-overlay { position: fixed; inset: 0; display: flex; align-items: center; justify-content: center; background: rgba(0,0,0,0.8); z-index: 100; font-family: Arial, Helvetica, sans-serif; }
        .error-panel { width: min(500px, 90vw); background: #111; color: #fff; border: 1px solid rgba(255,255,255,0.2); border-radius: 12px; padding: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        .error-panel h2 { margin: 0 0 15px; color: #fff; }
        .error-panel h3 { margin: 10px 0; color: #fff; }
        .error-panel p { margin: 8px 0; }
        .error-panel .btn { background: rgba(0,255,255,0.2); color: #fff; border: 1px solid rgba(0,255,255,0.4); padding: 10px 20px; border-radius: 6px; cursor: pointer; margin-top: 15px; }
        .error-panel .btn:hover { background: rgba(0,255,255,0.3); }
    </style>
    <script defer src="js/flappy.js"></script>
    </head>
<body>
    <div class="hud">
        <div>Score: <span id="score">0</span></div>
        <div>Best: <span id="best">0</span></div>
        <div>Time: <span id="time">0.0</span>s</div>
        <div>Reward: ₹<span id="reward">0.0</span></div>
        <button id="restart" class="btn">Restart</button>
    </div>
    <div id="connectionStatus" class="connection-status offline">Offline</div>
    <div id="gameContainer">
        <canvas id="flappyCanvas"></canvas>
    </div>
    <!-- Instruction / Practice Overlay -->
    <div id="overlayMenu" class="overlay show">
        <div class="panel">
            <h2>Scan & Play – Win Free Bottle!</h2>
            <div id="validationStatus">
                <p id="validationMessage">Validating QR code...</p>
                <div id="loadingSpinner" style="text-align: center; margin: 20px 0;">
                    <div style="display: inline-block; width: 20px; height: 20px; border: 2px solid #ccc; border-top: 2px solid #fff; border-radius: 50%; animation: spin 1s linear infinite;"></div>
                </div>
                <div id="retrySection" style="display: none; text-align: center; margin-top: 20px;">
                    <button id="btnRetry" class="btn">Try Again</button>
                </div>
            </div>
            <div id="gameContent" style="display: none;">
                <p>Play Flappy Bird and earn rewards toward a free ₹20 bottle. Score 15+ points in 1 minute to win!</p>
                <h3>How to play</h3>
                <ol>
                    <li>Tap, click, or press Space/Up to flap.</li>
                    <li>Avoid the pipes. Don't hit the ground or sky.</li>
                    <li>Score points and survive to earn rewards toward free bottle.</li>
                </ol>
                <p class="muted">Tip: Try the 10-second practice first. No deaths. No rewards counted.</p>
                <div class="actions">
                    <button id="btnPractice" class="btn" disabled>Practice (10s)</button>
                    <button id="btnStart" class="btn" disabled>Start Game</button>
                </div>
            </div>
        </div>
    </div>
    <!-- Results Overlay -->
    <div id="overlayResults" class="overlay">
        <div class="panel">
            <h2>Your Result</h2>
            <p>Score: <strong><span id="finalScore">0</span></strong></p>
            <p>Time Survived: <strong><span id="finalTime">0.0</span>s</strong></p>
            <p>Your Reward: <strong>₹<span id="finalReward">0.0</span></strong></p>
            <p id="bottleStatus" class="muted">Keep playing to win the free bottle!</p>
            <p class="muted">Show this screen at the counter to claim your reward.</p>
            <div id="claimSection" style="display: none; margin-top: 20px; padding: 15px; background: rgba(0,255,255,0.1); border-radius: 8px;">
                <h3>Claim Your Reward</h3>
                <p>Ask the restaurant staff to scan their claim QR code to process your reward.</p>
                <input type="text" id="claimQrInput" placeholder="Enter claim QR code" style="width: 100%; padding: 8px; margin: 10px 0; border: 1px solid #ccc; border-radius: 4px;">
                <input type="text" id="passKeyInput" placeholder="Enter 4-digit pass key" maxlength="4" style="width: 100%; padding: 8px; margin: 10px 0; border: 1px solid #ccc; border-radius: 4px;">
                <button id="claimRewardBtn" class="btn" style="width: 100%; margin-top: 10px;">Claim Reward</button>
            </div>
            <div class="actions">
                <button id="btnPlayAgain" class="btn">Play Again</button>
            </div>
        </div>
    </div>
</body>
</html>
